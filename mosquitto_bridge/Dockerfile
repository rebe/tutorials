# Wirepas Oy

FROM eclipse-mosquitto:1.4.12

EXPOSE 1883/tcp
EXPOSE 8883/tcp

ARG MQTT_USERNAME
ENV MOSQUITTO_USERNAME ${MQTT_USERNAME:-"mqttbridgeuser"}

ARG MQTT_PASSWORD
ENV MOSQUITTO_PASSWORD ${MQTT_PASSWORD:-"mqttbridgepassword"}

ENV MOSQUITTO_CONFIGURATION_DIR="/etc/mosquitto/conf.d"
ENV MOSQUITTO_CONFIGURATION_FILE="${MOSQUITTO_CONFIGURATION_DIR}/mosquitto.conf"
ENV MOSQUITTO_PASSWORD_FILE="${MOSQUITTO_CONFIGURATION_DIR}/passwd"

RUN mkdir -p $MOSQUITTO_CONFIGURATION_DIR

RUN touch $MOSQUITTO_PASSWORD_FILE
RUN mosquitto_passwd -b $MOSQUITTO_PASSWORD_FILE $MOSQUITTO_USERNAME $MOSQUITTO_PASSWORD

COPY mosquitto.conf ${MOSQUITTO_CONFIGURATION_FILE}

CMD mosquitto -c ${MOSQUITTO_CONFIGURATION_FILE}
